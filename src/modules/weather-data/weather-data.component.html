<div class="is-fullwidth is-fullheight is-flex is-flex-direction-column">
  <p class="title" translate="weather-data.title.dwd"></p>
  <div
    class="is-flex-grow-1 is-flex"
    [class.is-flex-direction-row]="layout() == 'row'"
    [class.is-flex-direction-column]="layout() == 'column'"
    style="gap: var(--bulma-column-gap)"
    resize-observer
    (resize)="onColumnsResize($event)"
  >
    <div map class="is-fullheight is-fullwidth">
      <div class="card is-fullheight">
        <div class="card-content p-0 is-fullheight is-clipped">
          <mgl-map
            class="is-fullheight"
            [style]="colorful"
            [zoom]="[5.3]"
            [center]="{
              lat: 51.16,
              lon: 10.45,
            }"
            [fitBounds]="$any(fitBounds())"
            [fitBoundsOptions]="{
              animate: true,
              duration: 500,
              essential: true,
            }"
            (click)="fitBounds.set(clusterPolygonSource().polygon().bbox)"
            (click)="hoverStationClusterId.set(null)"
            (click)="selectedStationId.set(hoverStationId())"
            [cursor]="cursor()"
          >
            <ng-container controls>
              <mgl-control
                mglNavigation
                [showCompass]="false"
                position="top-left"
              ></mgl-control>
              <mgl-control position="top-right">
                <map-layer-selection-control
                  [layers]="layers()"
                ></map-layer-selection-control>
              </mgl-control>
            </ng-container>
            <ng-container sources>
              <mgl-geojson-source
                id="stations-source"
                [data]="filteredStations()"
                [cluster]="true"
                [clusterMinPoints]="2"
                [clusterRadius]="100"
                #stationsSource
              ></mgl-geojson-source>
              <mgl-geojson-source
                mglClusterPolygon
                [source]="stationsSource"
                [clusterId]="hoverStationClusterId()"
                [data]="clusterPolygonSource().polygon()"
                id="stations-cluster-source"
              ></mgl-geojson-source>
            </ng-container>
            <ng-container layers>
              <mgl-layer
                id="stations-symbol"
                type="symbol"
                source="stations-source"
                [filter]="['!=', ['get', 'cluster'], true]"
                [layout]="{
                  'icon-image': 'remixicon:map-pin-2-line',
                  'icon-anchor': 'bottom',
                  'icon-overlap': 'always',
                  'text-field': ['get', 'name'],
                  'text-font': ['noto_sans_regular'],
                  'text-optional': true,
                  'text-anchor': 'top',
                }"
                [paint]="{
                  'icon-color': [
                    'case',
                    ['==', ['get', 'id'], ['string', selectedStationId(), '']],
                    '#0088AA',
                    '#000000',
                  ],
                }"
                (layerMouseLeave)="hoverStationId.set(null)"
                (layerMouseMove)="
                  hoverStationId.set($event.features![0].properties['id'])
                "
              ></mgl-layer>
              <mgl-layer
                id="stations-cluster-symbol"
                type="symbol"
                source="stations-source"
                [filter]="['==', ['get', 'cluster'], true]"
                [layout]="{
                  'icon-image': 'remixicon:pin-distance-line',
                }"
                (layerMouseLeave)="hoverStationClusterId.set(null)"
                (layerMouseMove)="
                  hoverStationClusterId.set(
                    util.cast($event.features![0].id, 'number')
                  )
                "
              ></mgl-layer>
              <mgl-layer
                id="stations-cluster-fill"
                type="fill"
                source="stations-cluster-source"
                [paint]="{
                  'fill-color': '#000000',
                  'fill-opacity': 0.2,
                }"
              ></mgl-layer>
              <mgl-layer
                id="stations-cluster-line"
                type="line"
                source="stations-cluster-source"
                [paint]="{
                  'line-color': '#000000',
                  'line-width': 2,
                }"
              ></mgl-layer>
            </ng-container>
          </mgl-map>
        </div>
      </div>
    </div>
    @let station = selectedStation();
    @if (station) {
      <div select class="is-fullheight is-fullwidth">
        <nav class="panel is-primary">
          <p class="panel-heading p-3">Attributes & Resolutions</p>
          <div class="panel-block">
            <p class="control has-icons-left">
              <input class="input" type="text" placeholder="Search" />
              <span class="icon is-left">
                <i class="fas fa-search" aria-hidden="true"></i>
              </span>
            </p>
          </div>
          <p class="panel-tabs">
            <a class="is-active">All</a>
            <a>Public</a>
            <a>Private</a>
            <a>Sources</a>
            <a>Forks</a>
          </p>
          <a class="panel-block is-active">
            <span class="panel-icon">
              <i class="fas fa-book" aria-hidden="true"></i>
            </span>
            bulma
          </a>
          <a class="panel-block">
            <span class="panel-icon">
              <i class="fas fa-book" aria-hidden="true"></i>
            </span>
            marksheet
          </a>
          <a class="panel-block">
            <span class="panel-icon">
              <i class="fas fa-book" aria-hidden="true"></i>
            </span>
            minireset.css
          </a>
          <a class="panel-block">
            <span class="panel-icon">
              <i class="fas fa-book" aria-hidden="true"></i>
            </span>
            jgthms.github.io
          </a>
          <a class="panel-block">
            <span class="panel-icon">
              <i class="fas fa-code-branch" aria-hidden="true"></i>
            </span>
            daniellowtw/infboard
          </a>
          <a class="panel-block">
            <span class="panel-icon">
              <i class="fas fa-code-branch" aria-hidden="true"></i>
            </span>
            mojs
          </a>
          <label class="panel-block">
            <input type="checkbox" />
            remember me
          </label>
          <div class="panel-block">
            <button class="button is-link is-outlined is-fullwidth">
              Reset all filters
            </button>
          </div>
        </nav>
      </div>
    }
  </div>
</div>
